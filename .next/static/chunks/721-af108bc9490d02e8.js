"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[721],{7648:function(e,t,o){o.d(t,{default:function(){return i.a}});var a=o(2972),i=o.n(a)},7324:function(e,t,o){o.d(t,{y:function(){return h}});var a=o(9861),i=o(5276),n=o(1394),r=o(4516),s=o(8146),u=o(4450);let h=(0,s.V)(u.S,[r.n,i.t,a.d,n.F])},9262:function(e,t,o){o.d(t,{j:function(){return a}});let a=()=>"undefined"!=typeof window&&void 0!==window.document},6014:function(e,t,o){o.d(t,{R:function(){return n}});var a=o(7701),i=o(5353);function n(e){if(!e||"Error"===e.name||e instanceof TypeError)throw new i.l({name:a.Z.Unknown,message:"An unknown error has occurred.",underlyingError:e})}},9443:function(e,t,o){o.d(t,{t:function(){return a}});let a="cognito-idp"},6085:function(e,t,o){o.d(t,{n:function(){return s}});var a=o(2221),i=o(8880),n=o(5902),r=o(5548);let s={service:o(9443).t,retryDecider:(0,a.j)(i.f),computeDelay:n.k,get userAgentValue(){return(0,r.Zm)()},cache:"no-store"}},3957:function(e,t,o){o.d(t,{x:function(){return n}});var a=o(8146),i=o(7324);let n=(0,a.V)(i.y,[()=>(e,t)=>async function(t){return t.headers["cache-control"]="no-store",e(t)}])},4724:function(e,t,o){o.d(t,{o:function(){return r}});var a=o(8880),i=o(6014),n=o(5353);let r=()=>async e=>{if(e.statusCode>=300){let t=await (0,a.f)(e);throw(0,i.R)(t),new n.l({name:t.name,message:t.message,metadata:t.$metadata})}return(0,a.e)(e)}},8092:function(e,t,o){o.d(t,{u:function(){return a}});let a=e=>(t,o)=>n(o,i(e),JSON.stringify(t)),i=e=>({"content-type":"application/x-amz-json-1.1","x-amz-target":`AWSCognitoIdentityProviderService.${e}`}),n=({url:e},t,o)=>({headers:t,url:e,body:o,method:"POST"})},2440:function(e,t,o){o.d(t,{N:function(){return n},y:function(){return i}});var a=o(5353);function i(e){let t=e?.split("_")[0];if(!e||0>e.indexOf("_")||!t||"string"!=typeof t)throw new a.l({name:"InvalidUserPoolId",message:"Invalid user pool id provided."});return t}function n(e){if(!e||!e.includes(":"))throw new a.l({name:"InvalidIdentityPoolIdException",message:"Invalid identity pool id provided.",recoverySuggestion:"Make sure a valid identityPoolId is given in the config."});return e.split(":")[0]}},9825:function(e,t,o){o.d(t,{e:function(){return s}});var a=o(9514),i=o(1849),n=o(9443);let r=({region:e})=>({url:new a.a(`https://${n.t}.${e}.${(0,i.b)(e)}`)}),s=({endpointOverride:e})=>t=>e?{url:new a.a(e)}:r(t)},2149:function(e,t,o){o.d(t,{sI:function(){return l},_X:function(){return d}});var a,i=o(4722),n=o(5353);let r={accessToken:"accessToken",idToken:"idToken",oidcProvider:"oidcProvider",clockDrift:"clockDrift",refreshToken:"refreshToken",deviceKey:"deviceKey",randomPasswordKey:"randomPasswordKey",deviceGroupKey:"deviceGroupKey",signInDetails:"signInDetails",oauthMetadata:"oauthMetadata"};var s=o(7808);(a||(a={})).InvalidAuthTokens="InvalidAuthTokens";let u={[a.InvalidAuthTokens]:{message:"Invalid tokens.",recoverySuggestion:"Make sure the tokens are valid."}},h=(0,s.$)(u),g="CognitoIdentityServiceProvider";class l{getKeyValueStorage(){if(!this.keyValueStorage)throw new n.l({name:"KeyValueStorageNotFoundException",message:"KeyValueStorage was not found in TokenStore"});return this.keyValueStorage}setKeyValueStorage(e){this.keyValueStorage=e}setAuthConfig(e){this.authConfig=e}async loadTokens(){try{let e=await this.getAuthKeys(),t=await this.getKeyValueStorage().getItem(e.accessToken);if(!t)throw new n.l({name:"NoSessionFoundException",message:"Auth session was not found. Make sure to call signIn."});let o=(0,i.xp)(t),a=await this.getKeyValueStorage().getItem(e.idToken),r=a?(0,i.xp)(a):void 0,s=await this.getKeyValueStorage().getItem(e.refreshToken)??void 0,u=await this.getKeyValueStorage().getItem(e.clockDrift)??"0",h=Number.parseInt(u),g=await this.getKeyValueStorage().getItem(e.signInDetails),l={accessToken:o,idToken:r,refreshToken:s,deviceMetadata:await this.getDeviceMetadata()??void 0,clockDrift:h,username:await this.getLastAuthUser()};return g&&(l.signInDetails=JSON.parse(g)),l}catch(e){return null}}async storeTokens(e){h(void 0!==e,a.InvalidAuthTokens);let t=e.username;await this.getKeyValueStorage().setItem(this.getLastAuthUserKey(),t);let o=await this.getAuthKeys();await this.getKeyValueStorage().setItem(o.accessToken,e.accessToken.toString()),e.idToken?await this.getKeyValueStorage().setItem(o.idToken,e.idToken.toString()):await this.getKeyValueStorage().removeItem(o.idToken),e.refreshToken?await this.getKeyValueStorage().setItem(o.refreshToken,e.refreshToken):await this.getKeyValueStorage().removeItem(o.refreshToken),e.deviceMetadata&&(e.deviceMetadata.deviceKey&&await this.getKeyValueStorage().setItem(o.deviceKey,e.deviceMetadata.deviceKey),e.deviceMetadata.deviceGroupKey&&await this.getKeyValueStorage().setItem(o.deviceGroupKey,e.deviceMetadata.deviceGroupKey),await this.getKeyValueStorage().setItem(o.randomPasswordKey,e.deviceMetadata.randomPassword)),e.signInDetails?await this.getKeyValueStorage().setItem(o.signInDetails,JSON.stringify(e.signInDetails)):await this.getKeyValueStorage().removeItem(o.signInDetails),await this.getKeyValueStorage().setItem(o.clockDrift,`${e.clockDrift}`)}async clearTokens(){let e=await this.getAuthKeys();await Promise.all([this.getKeyValueStorage().removeItem(e.accessToken),this.getKeyValueStorage().removeItem(e.idToken),this.getKeyValueStorage().removeItem(e.clockDrift),this.getKeyValueStorage().removeItem(e.refreshToken),this.getKeyValueStorage().removeItem(e.signInDetails),this.getKeyValueStorage().removeItem(this.getLastAuthUserKey()),this.getKeyValueStorage().removeItem(e.oauthMetadata)])}async getDeviceMetadata(e){let t=await this.getAuthKeys(e),o=await this.getKeyValueStorage().getItem(t.deviceKey),a=await this.getKeyValueStorage().getItem(t.deviceGroupKey),i=await this.getKeyValueStorage().getItem(t.randomPasswordKey);return i&&a&&o?{deviceKey:o,deviceGroupKey:a,randomPassword:i}:null}async clearDeviceMetadata(e){let t=await this.getAuthKeys(e);await Promise.all([this.getKeyValueStorage().removeItem(t.deviceKey),this.getKeyValueStorage().removeItem(t.deviceGroupKey),this.getKeyValueStorage().removeItem(t.randomPasswordKey)])}async getAuthKeys(e){(0,i.FG)(this.authConfig?.Cognito);let t=e??await this.getLastAuthUser();return c(g,`${this.authConfig.Cognito.userPoolClientId}.${t}`)}getLastAuthUserKey(){(0,i.FG)(this.authConfig?.Cognito);let e=this.authConfig.Cognito.userPoolClientId;return`${g}.${e}.LastAuthUser`}async getLastAuthUser(){return await this.getKeyValueStorage().getItem(this.getLastAuthUserKey())??"username"}async setOAuthMetadata(e){let{oauthMetadata:t}=await this.getAuthKeys();await this.getKeyValueStorage().setItem(t,JSON.stringify(e))}async getOAuthMetadata(){let{oauthMetadata:e}=await this.getAuthKeys(),t=await this.getKeyValueStorage().getItem(e);return t&&JSON.parse(t)}}let c=(e,t)=>d(r)(`${e}`,t);function d(e){let t=Object.values({...e});return(e,o)=>t.reduce((t,a)=>({...t,[a]:`${e}.${o}.${a}`}),{})}},5274:function(e,t,o){let a;o.d(t,{D:function(){return V},C:function(){return P}});var i,n=o(2876),r=o(4722),s=o(2440),u=o(3705),h=o(5353),g=o(9825),l=o(1742),c=o(8092),d=o(4724),f=o(3957),y=o(6085);let k=e=>(0,l.z)(f.x,(0,c.u)("GetTokensFromRefreshToken"),(0,d.o)(),{...y.n,...e}),m=(i=async({tokens:e,authConfig:t,username:o,clientMetadata:a})=>{(0,r.FG)(t?.Cognito);let{userPoolId:i,userPoolClientId:n,userPoolEndpoint:l}=t.Cognito,c=(0,s.y)(i);(0,u.XD)(e);let d=k({endpointResolver:(0,g.e)({endpointOverride:l})}),{AuthenticationResult:f}=await d({region:c},{ClientId:n,RefreshToken:e.refreshToken,DeviceKey:e.deviceMetadata?.deviceKey,ClientMetadata:a}),y=(0,r.xp)(f?.AccessToken??""),m=f?.IdToken?(0,r.xp)(f.IdToken):void 0,{iat:v}=y.payload;if(!v)throw new h.l({name:"iatNotFoundException",message:"iat not found in access token"});return{accessToken:y,idToken:m,clockDrift:1e3*v-new Date().getTime(),refreshToken:f?.RefreshToken??e.refreshToken,username:o}},async(...e)=>a||(a=new Promise((t,o)=>{i(...e).then(e=>{t(e)}).catch(e=>{o(e)}).finally(()=>{a=void 0})})));var v=o(2149),S=o(5871),I=o(9262);function w({expiresAt:e,clockDrift:t,tolerance:o=5e3}){return Date.now()+t+o>e}var T=o(6014),K=o(5795),C=o(4236);class A{constructor(){this.waitForInflightOAuth=(0,I.j)()?async()=>await K.V.loadOAuthInFlight()?(this.inflightPromise||(this.inflightPromise=new Promise((e,t)=>{(0,C.q)(e)})),this.inflightPromise):void 0:async()=>{}}setAuthConfig(e){K.V.setAuthConfig(e.Cognito),this.authConfig=e}setTokenRefresher(e){this.tokenRefresher=e}setAuthTokenStore(e){this.tokenStore=e}getTokenStore(){if(!this.tokenStore)throw new h.l({name:"EmptyTokenStoreException",message:"TokenStore not set"});return this.tokenStore}getTokenRefresher(){if(!this.tokenRefresher)throw new h.l({name:"EmptyTokenRefresherException",message:"TokenRefresher not set"});return this.tokenRefresher}setClientMetadataProvider(e){this.clientMetadataProvider=e}async getTokens(e){let t;try{(0,r.FG)(this.authConfig?.Cognito)}catch(e){return null}await this.waitForInflightOAuth(),this.inflightPromise=void 0,t=await this.getTokenStore().loadTokens();let o=await this.getTokenStore().getLastAuthUser();if(null===t)return null;let a=!!t?.idToken&&w({expiresAt:(t.idToken?.payload?.exp??0)*1e3,clockDrift:t.clockDrift??0}),i=w({expiresAt:(t.accessToken?.payload?.exp??0)*1e3,clockDrift:t.clockDrift??0});return(e?.forceRefresh||a||i)&&null===(t=await this.refreshTokens({tokens:t,username:o,clientMetadata:e?.clientMetadata??await this.clientMetadataProvider?.()}))?null:{accessToken:t?.accessToken,idToken:t?.idToken,signInDetails:t?.signInDetails}}async refreshTokens({tokens:e,username:t,clientMetadata:o}){try{let{signInDetails:a}=e,i=await this.getTokenRefresher()({tokens:e,authConfig:this.authConfig,username:t,clientMetadata:o});return i.signInDetails=a,await this.setTokens({tokens:i}),S.Xb.dispatch("auth",{event:"tokenRefresh"},"Auth",S.SQ),i}catch(e){return this.handleErrors(e)}}handleErrors(e){if((0,T.R)(e),this.isAuthenticationError(e)&&this.clearTokens(),S.Xb.dispatch("auth",{event:"tokenRefresh_failure",data:{error:e}},"Auth",S.SQ),e.name.startsWith("NotAuthorizedException"))return null;throw e}isAuthenticationError(e){return["NotAuthorizedException","TokenRevokedException","UserNotFoundException","PasswordResetRequiredException","UserNotConfirmedException","RefreshTokenReuseException"].some(t=>e?.name?.startsWith?.(t))}async setTokens({tokens:e}){return this.getTokenStore().storeTokens(e)}async clearTokens(){return this.getTokenStore().clearTokens()}getDeviceMetadata(e){return this.getTokenStore().getDeviceMetadata(e)}clearDeviceMetadata(e){return this.getTokenStore().clearDeviceMetadata(e)}setOAuthMetadata(e){return this.getTokenStore().setOAuthMetadata(e)}getOAuthMetadata(){return this.getTokenStore().getOAuthMetadata()}}class p{constructor(){this.authTokenStore=new v.sI,this.authTokenStore.setKeyValueStorage(n.Fm),this.tokenOrchestrator=new A,this.tokenOrchestrator.setAuthTokenStore(this.authTokenStore),this.tokenOrchestrator.setTokenRefresher(m)}getTokens(e={}){return this.tokenOrchestrator.getTokens(e)}setKeyValueStorage(e){this.authTokenStore.setKeyValueStorage(e)}setClientMetadataProvider(e){this.tokenOrchestrator.setClientMetadataProvider(e)}setAuthConfig(e){this.authTokenStore.setAuthConfig(e),this.tokenOrchestrator.setAuthConfig(e)}}let V=new p,{tokenOrchestrator:P}=V},4236:function(e,t,o){o.d(t,{P:function(){return n},q:function(){return i}});let a=[],i=e=>{a.push(e)},n=()=>{for(;a.length;)a.pop()?.()}},5795:function(e,t,o){o.d(t,{V:function(){return i}});var a=o(2876);let i=new(o(9653)).R(a.Fm)},9653:function(e,t,o){o.d(t,{R:function(){return u}});var a=o(4722),i=o(2149),n=o(3705);let r="amplify-signin-with-hostedUI",s="CognitoIdentityServiceProvider";class u{constructor(e){this.keyValueStorage=e}async clearOAuthInflightData(){(0,a.FG)(this.cognitoConfig);let e=h(s,this.cognitoConfig.userPoolClientId);await Promise.all([this.keyValueStorage.removeItem(e.inflightOAuth),this.keyValueStorage.removeItem(e.oauthPKCE),this.keyValueStorage.removeItem(e.oauthState)])}async clearOAuthData(){(0,a.FG)(this.cognitoConfig);let e=h(s,this.cognitoConfig.userPoolClientId);return await this.clearOAuthInflightData(),await this.keyValueStorage.removeItem(r),this.keyValueStorage.removeItem(e.oauthSignIn)}loadOAuthState(){(0,a.FG)(this.cognitoConfig);let e=h(s,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.getItem(e.oauthState)}storeOAuthState(e){(0,a.FG)(this.cognitoConfig);let t=h(s,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.setItem(t.oauthState,e)}loadPKCE(){(0,a.FG)(this.cognitoConfig);let e=h(s,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.getItem(e.oauthPKCE)}storePKCE(e){(0,a.FG)(this.cognitoConfig);let t=h(s,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.setItem(t.oauthPKCE,e)}setAuthConfig(e){this.cognitoConfig=e}async loadOAuthInFlight(){(0,a.FG)(this.cognitoConfig);let e=h(s,this.cognitoConfig.userPoolClientId);return await this.keyValueStorage.getItem(e.inflightOAuth)==="true"}async storeOAuthInFlight(e){(0,a.FG)(this.cognitoConfig);let t=h(s,this.cognitoConfig.userPoolClientId);await this.keyValueStorage.setItem(t.inflightOAuth,`${e}`)}async loadOAuthSignIn(){(0,a.FG)(this.cognitoConfig);let e=h(s,this.cognitoConfig.userPoolClientId),t=await this.keyValueStorage.getItem(r),[o,i]=(await this.keyValueStorage.getItem(e.oauthSignIn))?.split(",")??[];return{isOAuthSignIn:"true"===o||"true"===t,preferPrivateSession:"true"===i}}async storeOAuthSignIn(e,t=!1){(0,a.FG)(this.cognitoConfig);let o=h(s,this.cognitoConfig.userPoolClientId);await this.keyValueStorage.setItem(o.oauthSignIn,`${e},${t}`)}}let h=(e,t)=>(0,i._X)(n.Bx)(e,t)}}]);