(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{3954:function(e,t,s){Promise.resolve().then(s.bind(s,9468))},9468:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var l=s(7437),a=s(2265),i=s(7715),n=s(3005),d=s(4810),r=s(389);async function c(){try{var e,t,s;let l=await (0,d.t)(),a=await (0,r.y)(),i=null!==(s=null===(t=a.tokens)||void 0===t?void 0:null===(e=t.accessToken)||void 0===e?void 0:e.payload["cognito:groups"])&&void 0!==s?s:[];return{user:l,groups:i}}catch(e){return null}}function o(e,t){let s=null!=e?e:[];return"Admin"===t?s.includes("Admin"):s.includes("Admin")||s.includes("Editor")}var m=s(3884),x=s(9820),u=s(2381),h=s(7648),v=s(4438);function f(){let[e,t]=(0,a.useState)(!0),[s,d]=(0,a.useState)(!1),[r,f]=(0,a.useState)(!1),[N,g]=(0,a.useState)({leadsNew:0,subsConfirmed:0,topPages:[]}),y=(0,a.useCallback)(async()=>{var e,s,l,a;t(!0);try{let t=await c();if(!t){d(!1),f(!1);return}if(d(!0),f(o(t.groups,"Editor")),!o(t.groups,"Editor"))return;let[a,i,n]=await Promise.all([m.W.models.Lead.list({filter:{status:{eq:"NEW"}},limit:200}),m.W.models.NewsletterSubscriber.list({filter:{status:{eq:"CONFIRMED"}},limit:200}),m.W.models.PageView.list({limit:200})]),r=new Map;(null!==(e=n.data)&&void 0!==e?e:[]).forEach(e=>{var t;return r.set(e.path,(null!==(t=r.get(e.path))&&void 0!==t?t:0)+1)});let x=Array.from(r.entries()).sort((e,t)=>t[1]-e[1]).slice(0,8).map(e=>{let[t,s]=e;return{path:t,count:s}});g({leadsNew:(null!==(s=a.data)&&void 0!==s?s:[]).length,subsConfirmed:(null!==(l=i.data)&&void 0!==l?l:[]).length,topPages:x})}catch(e){v.Am.error(null!==(a=null==e?void 0:e.message)&&void 0!==a?a:"Failed to load dashboard")}finally{t(!1)}},[]);(0,a.useEffect)(()=>{y()},[y]);let w=async()=>{await (0,i.F)({provider:"Google"}).catch(()=>(0,i.F)())},S=async()=>{await (0,n.w)(),v.Am.success("Signed out"),await y()};return e?(0,l.jsx)("div",{className:"rounded-2xl bg-slate-50 p-10 text-slate-600",children:"Loading…"}):s?r?(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"flex items-end justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-3xl font-semibold tracking-tight",children:"Dashboard"}),(0,l.jsx)("p",{className:"mt-2 text-slate-600",children:"Content, leads, newsletter, and analytics."})]}),(0,l.jsx)(u.z,{variant:"outline",onClick:S,children:"Sign out"})]}),(0,l.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[(0,l.jsxs)(x.Zb,{className:"p-5",children:[(0,l.jsx)("div",{className:"text-xs text-slate-600",children:"New leads"}),(0,l.jsx)("div",{className:"mt-1 text-3xl font-semibold",children:N.leadsNew})]}),(0,l.jsxs)(x.Zb,{className:"p-5",children:[(0,l.jsx)("div",{className:"text-xs text-slate-600",children:"Newsletter subscribers"}),(0,l.jsx)("div",{className:"mt-1 text-3xl font-semibold",children:N.subsConfirmed})]}),(0,l.jsxs)(x.Zb,{className:"p-5",children:[(0,l.jsx)("div",{className:"text-xs text-slate-600",children:"Top pages"}),(0,l.jsxs)("div",{className:"mt-2 space-y-1 text-sm",children:[N.topPages.map(e=>(0,l.jsxs)("div",{className:"flex items-center justify-between rounded-xl bg-slate-50 px-3 py-2",children:[(0,l.jsx)("span",{className:"font-medium",children:e.path}),(0,l.jsx)("span",{className:"text-slate-600",children:e.count})]},e.path)),0===N.topPages.length?(0,l.jsx)("div",{className:"text-slate-500",children:"No data yet."}):null]})]})]}),(0,l.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,l.jsx)(j,{title:"Blog Posts",model:"BlogPost"}),(0,l.jsx)(j,{title:"Case Studies",model:"CaseStudy"}),(0,l.jsx)(j,{title:"Services",model:"Service"}),(0,l.jsx)(j,{title:"Testimonials",model:"Testimonial"})]}),(0,l.jsx)(p,{}),(0,l.jsx)(b,{})]}):(0,l.jsxs)(x.Zb,{className:"p-8",children:[(0,l.jsx)("div",{className:"text-2xl font-semibold",children:"Access denied"}),(0,l.jsx)("p",{className:"mt-2 text-slate-600",children:"Your account does not have Editor/Admin permissions."}),(0,l.jsxs)("div",{className:"mt-6 flex gap-2",children:[(0,l.jsx)(u.z,{onClick:S,variant:"outline",children:"Sign out"}),(0,l.jsx)(h.default,{href:"/",children:(0,l.jsx)(u.z,{children:"Back home"})})]})]}):(0,l.jsxs)(x.Zb,{className:"p-8",children:[(0,l.jsx)("div",{className:"text-2xl font-semibold",children:"Admin Dashboard"}),(0,l.jsx)("p",{className:"mt-2 text-slate-600",children:"Sign in to manage site content and analytics."}),(0,l.jsxs)("div",{className:"mt-6 flex gap-2",children:[(0,l.jsx)(u.z,{onClick:w,children:"Sign in"}),(0,l.jsx)(h.default,{href:"/",children:(0,l.jsx)(u.z,{variant:"outline",children:"Back home"})})]})]})}function j(e){let{title:t,model:s}=e,[i,n]=(0,a.useState)(!0),[d,r]=(0,a.useState)([]),[c,o]=(0,a.useState)(!1),h=(0,a.useCallback)(async()=>{var e;n(!0),r(null!==(e=(await m.W.models[s].list({limit:50})).data)&&void 0!==e?e:[]),n(!1)},[s]);return(0,a.useEffect)(()=>{h()},[h]),(0,l.jsxs)(x.Zb,{children:[(0,l.jsxs)(x.Ol,{className:"flex flex-row items-center justify-between",children:[(0,l.jsx)("div",{className:"text-sm font-semibold",children:t}),(0,l.jsx)(u.z,{size:"sm",onClick:()=>o(e=>!e),children:c?"Hide":"Manage"})]}),(0,l.jsxs)(x.aY,{children:[i?(0,l.jsx)("div",{className:"text-sm text-slate-600",children:"Loading…"}):null,i||c?null:(0,l.jsxs)("div",{className:"text-sm text-slate-600",children:[d.length," items"]}),!i&&c?(0,l.jsxs)("div",{className:"space-y-2",children:[d.map(e=>{var t,a,i;return(0,l.jsx)("div",{className:"rounded-xl border border-slate-200 p-3",children:(0,l.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-sm font-semibold",children:null!==(t=e.title)&&void 0!==t?t:e.name}),(0,l.jsx)("div",{className:"text-xs text-slate-600",children:null!==(i=null!==(a=e.status)&&void 0!==a?a:e.category)&&void 0!==i?i:""})]}),(0,l.jsx)("div",{className:"flex gap-2",children:(0,l.jsx)(u.z,{size:"sm",variant:"outline",onClick:async()=>{var t;await m.W.models[s].delete({id:e.id}),await m.W.models.AuditLog.create({action:"DELETE",entity:s,entityId:e.id,metaJson:JSON.stringify({title:null!==(t=e.title)&&void 0!==t?t:e.name})}),v.Am.success("Deleted"),h()},children:"Delete"})})]})},e.id)}),(0,l.jsx)("div",{className:"rounded-xl bg-slate-50 p-3 text-xs text-slate-600",children:"Create/edit is done via quick JSON import below for speed. (Still validated + audited.)"}),(0,l.jsx)(N,{model:s,onDone:h})]}):null]})]})}function N(e){let{model:t,onDone:s}=e,[i,n]=(0,a.useState)(""),d=async()=>{var e,l,a;try{let a=JSON.parse(i),d=await m.W.models[t].upsert(a);await m.W.models.AuditLog.create({action:"UPSERT",entity:t,entityId:null!==(l=null===(e=d.data)||void 0===e?void 0:e.id)&&void 0!==l?l:"",metaJson:JSON.stringify({})}),v.Am.success("Saved"),n(""),s()}catch(e){v.Am.error(null!==(a=null==e?void 0:e.message)&&void 0!==a?a:"Invalid JSON")}};return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("textarea",{className:"min-h-[140px] w-full rounded-xl border border-slate-200 p-3 text-xs font-mono",value:i,onChange:e=>n(e.target.value),placeholder:'{"id":"...","title":"..."}'}),(0,l.jsx)(u.z,{onClick:d,children:"Upsert"})]})}function p(){let[e,t]=(0,a.useState)([]),[s,i]=(0,a.useState)(!0),n=async()=>{var e;i(!0),t((null!==(e=(await m.W.models.Lead.list({limit:100})).data)&&void 0!==e?e:[]).sort((e,t)=>{var s,l;return(null!==(s=t.createdAt)&&void 0!==s?s:"").localeCompare(null!==(l=e.createdAt)&&void 0!==l?l:"")})),i(!1)};return(0,a.useEffect)(()=>{n()},[]),(0,l.jsxs)(x.Zb,{children:[(0,l.jsxs)(x.Ol,{className:"flex flex-row items-center justify-between",children:[(0,l.jsx)("div",{className:"text-sm font-semibold",children:"Leads"}),(0,l.jsx)(u.z,{size:"sm",variant:"outline",onClick:n,children:"Refresh"})]}),(0,l.jsxs)(x.aY,{children:[s?(0,l.jsx)("div",{className:"text-sm text-slate-600",children:"Loading…"}):null,s||0!==e.length?null:(0,l.jsx)("div",{className:"rounded-2xl bg-slate-50 p-6 text-sm text-slate-600",children:"No leads yet."}),(0,l.jsx)("div",{className:"grid gap-2",children:e.slice(0,25).map(e=>(0,l.jsx)("div",{className:"rounded-2xl border border-slate-200 p-4",children:(0,l.jsxs)("div",{className:"flex flex-col gap-2 md:flex-row md:items-start md:justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"font-semibold",children:[e.name," ",(0,l.jsxs)("span",{className:"text-slate-500 text-sm",children:["(",e.email,")"]})]}),(0,l.jsxs)("div",{className:"text-xs text-brand-700 font-semibold",children:[e.inquiryType," • ",e.status]}),(0,l.jsx)("div",{className:"mt-2 text-sm text-slate-700 whitespace-pre-wrap",children:e.message})]}),(0,l.jsx)("div",{className:"flex gap-2",children:(0,l.jsx)(u.z,{size:"sm",onClick:async()=>{await m.W.models.Lead.update({id:e.id,status:"CONTACTED"}),await m.W.models.AuditLog.create({action:"UPDATE",entity:"Lead",entityId:e.id,metaJson:JSON.stringify({status:"CONTACTED"})}),v.Am.success("Marked contacted"),n()},children:"Mark contacted"})})]})},e.id))})]})]})}function b(){let[e,t]=(0,a.useState)([]),s=async()=>{var e;t((null!==(e=(await m.W.models.Outbox.list({limit:50})).data)&&void 0!==e?e:[]).sort((e,t)=>{var s,l;return(null!==(s=t.createdAt)&&void 0!==s?s:"").localeCompare(null!==(l=e.createdAt)&&void 0!==l?l:"")}))};return(0,a.useEffect)(()=>{s()},[]),(0,l.jsxs)(x.Zb,{children:[(0,l.jsxs)(x.Ol,{className:"flex flex-row items-center justify-between",children:[(0,l.jsx)("div",{className:"text-sm font-semibold",children:"Email Outbox"}),(0,l.jsx)(u.z,{size:"sm",variant:"outline",onClick:s,children:"Refresh"})]}),(0,l.jsx)(x.aY,{children:(0,l.jsxs)("div",{className:"space-y-2 text-sm",children:[e.map(e=>(0,l.jsxs)("div",{className:"rounded-xl border border-slate-200 p-3",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("div",{className:"font-semibold",children:e.type}),(0,l.jsx)("div",{className:"text-xs text-slate-600",children:e.status})]}),(0,l.jsx)("div",{className:"mt-1 text-xs text-slate-600 line-clamp-2",children:e.payloadJson})]},e.id)),0===e.length?(0,l.jsx)("div",{className:"rounded-2xl bg-slate-50 p-6 text-sm text-slate-600",children:"No outbox jobs."}):null]})})]})}},2381:function(e,t,s){"use strict";s.d(t,{z:function(){return n}});var l=s(7437),a=s(2265),i=s(3448);let n=a.forwardRef((e,t)=>{let{className:s,variant:a="default",size:n="md",...d}=e;return(0,l.jsx)("button",{ref:t,className:(0,i.cn)("inline-flex items-center justify-center rounded-xl font-medium transition focus:outline-none focus:ring-2 focus:ring-brand-300 disabled:opacity-50 disabled:pointer-events-none","default"===a?"bg-brand-600 text-white hover:bg-brand-700":"secondary"===a?"bg-slate-900 text-white hover:bg-slate-800":"outline"===a?"border border-slate-200 hover:bg-slate-50":"hover:bg-slate-50","sm"===n?"h-9 px-3 text-sm":"lg"===n?"h-12 px-5 text-base":"h-10 px-4 text-sm",s),...d})});n.displayName="Button"},9820:function(e,t,s){"use strict";s.d(t,{Ol:function(){return n},Zb:function(){return i},aY:function(){return d}});var l=s(7437);s(2265);var a=s(3448);function i(e){let{className:t,...s}=e;return(0,l.jsx)("div",{className:(0,a.cn)("rounded-2xl border border-slate-200 bg-white shadow-soft",t),...s})}function n(e){let{className:t,...s}=e;return(0,l.jsx)("div",{className:(0,a.cn)("p-6 pb-3",t),...s})}function d(e){let{className:t,...s}=e;return(0,l.jsx)("div",{className:(0,a.cn)("p-6 pt-3",t),...s})}},3884:function(e,t,s){"use strict";s.d(t,{W:function(){return i}});var l=s(8571);let a=null,i=(()=>{if(!a)try{a=(0,l.d)()}catch(e){console.error("Failed to create data client:",e),a=new Proxy({},{get:()=>({list:()=>Promise.resolve({data:[]}),get:()=>Promise.resolve({data:null}),create:()=>Promise.reject(Error("Data client not available")),update:()=>Promise.reject(Error("Data client not available")),delete:()=>Promise.reject(Error("Data client not available"))})})}return a})()},3448:function(e,t,s){"use strict";s.d(t,{cn:function(){return i}});var l=s(1994),a=s(3335);function i(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,a.m6)((0,l.W)(t))}}},function(e){e.O(0,[972,952,39,721,310,971,117,744],function(){return e(e.s=3954)}),_N_E=e.O()}]);